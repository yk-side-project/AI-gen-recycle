# AI-gen-recycle Frontend (Next.js)

**Next.js 15 + TypeScript** Í∏∞Î∞òÏùò OAuth Î°úÍ∑∏Ïù∏ÏùÑ ÏßÄÏõêÌïòÎäî Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÌîÑÎ°†Ìä∏ÏóîÎìúÏûÖÎãàÎã§.

> ‚ö†Ô∏è **Migration Notice**: Vite + ReactÏóêÏÑú Next.jsÎ°ú ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖòÎêòÏóàÏäµÎãàÎã§. (SEO ÏµúÏ†ÅÌôî)

---

## üìÅ ÎîîÎ†âÌÜ†Î¶¨ Íµ¨Ï°∞

```text
frontend-migration/
  ‚îú‚îÄ‚îÄ app/                          # Next.js App Router
  ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Î£®Ìä∏ Î†àÏù¥ÏïÑÏõÉ
  ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                  # Ìôà ÌéòÏù¥ÏßÄ
  ‚îÇ   ‚îú‚îÄ‚îÄ providers.tsx             # React Query Provider ‚≠ê
  ‚îÇ   ‚îú‚îÄ‚îÄ login/
  ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx              # Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ ‚≠ê
  ‚îÇ   ‚îú‚îÄ‚îÄ auth/
  ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callback/
  ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx          # OAuth ÏΩúÎ∞± ÌéòÏù¥ÏßÄ ‚≠ê
  ‚îÇ   ‚îî‚îÄ‚îÄ gallery/
  ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx              # Ïù¥ÎØ∏ÏßÄ Í∞§Îü¨Î¶¨
  ‚îú‚îÄ‚îÄ components/                   # Ïû¨ÏÇ¨Ïö© Ïª¥Ìè¨ÎÑåÌä∏
  ‚îÇ   ‚îî‚îÄ‚îÄ home/
  ‚îÇ       ‚îî‚îÄ‚îÄ Images.tsx            # Ïù¥ÎØ∏ÏßÄ Î™©Î°ù Ïª¥Ìè¨ÎÑåÌä∏
  ‚îú‚îÄ‚îÄ queries/                      # React Query hooks
  ‚îÇ   ‚îú‚îÄ‚îÄ login/                    # OAuth Î°úÍ∑∏Ïù∏ Î°úÏßÅ ‚≠ê
  ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.ts              # API Ìï®ÏàòÎì§
  ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ axios-config.ts       # Axios Ïù∏ÌÑ∞ÏÖâÌÑ∞ (ÌÜ†ÌÅ∞ Í∞±Ïã†)
  ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts              # React Query hooks
  ‚îÇ   ‚îî‚îÄ‚îÄ image/                    # Ïù¥ÎØ∏ÏßÄ Í¥ÄÎ†® API
  ‚îÇ       ‚îú‚îÄ‚îÄ image.ts
  ‚îÇ       ‚îî‚îÄ‚îÄ index.ts
  ‚îú‚îÄ‚îÄ stores/                       # Zustand ÏÉÅÌÉú Í¥ÄÎ¶¨
  ‚îÇ   ‚îî‚îÄ‚îÄ shared/
  ‚îÇ       ‚îî‚îÄ‚îÄ user.ts               # Auth store (ÌÜ†ÌÅ∞, ÏÇ¨Ïö©Ïûê) ‚≠ê
  ‚îú‚îÄ‚îÄ types/                        # TypeScript ÌÉÄÏûÖ Ï†ïÏùò
  ‚îÇ   ‚îî‚îÄ‚îÄ shared/
  ‚îÇ       ‚îú‚îÄ‚îÄ user.ts
  ‚îÇ       ‚îî‚îÄ‚îÄ index.ts
  ‚îú‚îÄ‚îÄ .env                          # ÌôòÍ≤Ω Î≥ÄÏàò
  ‚îú‚îÄ‚îÄ next.config.ts                # Next.js ÏÑ§Ï†ï
  ‚îú‚îÄ‚îÄ package.json
  ‚îî‚îÄ‚îÄ tsconfig.json
```

---

## üõ†Ô∏è Í∏∞Ïà† Ïä§ÌÉù

| Ïπ¥ÌÖåÍ≥†Î¶¨ | Í∏∞Ïà† |
|---------|------|
| **ÌîÑÎ†àÏûÑÏõåÌÅ¨** | Next.js 15.1.6 |
| **Ïñ∏Ïñ¥** | TypeScript 5.x |
| **ÎùºÏö∞ÌåÖ** | Next.js App Router (SSR/SSG) ‚≠ê |
| **ÏÉÅÌÉú Í¥ÄÎ¶¨** | Zustand 5.0.4 (ÌÜ†ÌÅ∞, ÏÇ¨Ïö©Ïûê) |
| **ÏÑúÎ≤Ñ ÏÉÅÌÉú** | TanStack React Query 5.x |
| **HTTP ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏** | Axios (ÌÜ†ÌÅ∞ Í∞±Ïã† Ïù∏ÌÑ∞ÏÖâÌÑ∞) ‚≠ê |
| **Ïä§ÌÉÄÏùºÎßÅ** | Tailwind CSS + CSS Modules |

---

## üöÄ Ïã§Ìñâ Î∞©Î≤ï

### 1) Í∞úÎ∞ú ÏÑúÎ≤Ñ ÏãúÏûë

```bash
cd frontend-migration

# ÏùòÏ°¥ÏÑ± ÏÑ§Ïπò
npm install

# Í∞úÎ∞ú ÏÑúÎ≤Ñ Ïã§Ìñâ
npm run dev
```

‚Üí `http://localhost:3000` Ï†ëÏÜç

### 2) ÌîÑÎ°úÎçïÏÖò ÎπåÎìú

```bash
# ÎπåÎìú
npm run build

# ÌîÑÎ°úÎçïÏÖò ÏÑúÎ≤Ñ Ïã§Ìñâ
npm start
```

### 3) ÏΩîÎìú ÌíàÏßà

```bash
# ESLint Ïã§Ìñâ
npm run lint

# Prettier Ìè¨Îß∑ÌåÖ
npm run prettier:fix
```

---

## üîê OAuth Î°úÍ∑∏Ïù∏ ÌîåÎ°úÏö∞

### Ï†ÑÏ≤¥ ÌùêÎ¶ÑÎèÑ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    ÏÇ¨Ïö©Ïûê Î∏åÎùºÏö∞Ï†Ä                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                                               ‚îÇ
     ‚îÇ 1. /login Ï†ëÏÜç                                ‚îÇ 7. /auth/callback?token=xxx&refresh_token=yyy
     ‚îÇ                                               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Next.js App (localhost:3000) ‚≠ê                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Login ÌéòÏù¥ÏßÄ (Client)          AuthCallback ÌéòÏù¥ÏßÄ (Client) ‚îÇ
‚îÇ  - "GoogleÎ°ú Î°úÍ∑∏Ïù∏" Î≤ÑÌäº          - URLÏóêÏÑú ÌÜ†ÌÅ∞ Ï∂îÏ∂ú        ‚îÇ
‚îÇ  - ÌÅ¥Î¶≠ Ïãú Î¶¨Îã§Ïù¥Î†âÌä∏              - ZustandÏóê ÌÜ†ÌÅ∞ Ï†ÄÏû•      ‚îÇ
‚îÇ  - ÌÖåÏä§Ìä∏ Î°úÍ∑∏Ïù∏ (dev only)       - ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå         ‚îÇ
‚îÇ                                  - ÌôàÏúºÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îÇ 2. window.location.href = "/auth/oauth/google"
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Auth ÏÑúÎ≤Ñ (localhost:8001)                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  3. GoogleÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏                                       ‚îÇ
‚îÇ  4. ÏΩúÎ∞± Ï≤òÎ¶¨ (/auth/oauth/google/callback)                 ‚îÇ
‚îÇ  5. DBÏóê ÏÇ¨Ïö©Ïûê Ï†ÄÏû•                                         ‚îÇ
‚îÇ  6. JWT Access Token + Refresh Token ÏÉùÏÑ± ‚≠ê                ‚îÇ
‚îÇ  7. ÌîÑÎ°†Ìä∏ÏóîÎìúÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏ (Îëê ÌÜ†ÌÅ∞ Ìè¨Ìï®)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îÇ 3-6. Google OAuth
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Google OAuth                                ‚îÇ
‚îÇ  - ÏÇ¨Ïö©Ïûê Î°úÍ∑∏Ïù∏                                              ‚îÇ
‚îÇ  - Í∂åÌïú ÏäπÏù∏                                                 ‚îÇ
‚îÇ  - Auth ÏÑúÎ≤ÑÎ°ú ÏΩúÎ∞±                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìù Ï£ºÏöî ÌååÏùº ÏÑ§Î™Ö

### 1. `app/providers.tsx` - React Query Provider ‚≠ê

```typescript
'use client'

import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { useState } from 'react'

/**
 * React Query Provider (Client Component)
 * - Server ComponentÏóêÏÑú QueryClientÎ•º ÏßÅÏ†ë ÏÉùÏÑ±ÌïòÎ©¥ ÏóêÎü¨ Î∞úÏÉù
 * - useStateÎ°ú ClientÏóêÏÑú ÏÉùÏÑ±
 */
export function Providers({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            staleTime: 60 * 1000,
            refetchOnWindowFocus: false,
          },
        },
      })
  )

  return (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  )
}
```

---

### 2. `queries/login/axios-config.ts` - Axios Ïù∏ÌÑ∞ÏÖâÌÑ∞ (ÌÜ†ÌÅ∞ Í∞±Ïã†) ‚≠ê

```typescript
import axios from 'axios'
import { useAuthStore } from '@/stores/shared/user'
import { refreshAccessToken } from './login'

const AUTH_API_BASE = process.env.NEXT_PUBLIC_AUTH_API_BASE || 'http://localhost:8001'

export const authAxios = axios.create({
  baseURL: AUTH_API_BASE,
})

/**
 * Request Ïù∏ÌÑ∞ÏÖâÌÑ∞: Access Token ÏûêÎèô Ï∂îÍ∞Ä
 */
authAxios.interceptors.request.use((config) => {
  const token = useAuthStore.getState().token
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

/**
 * Response Ïù∏ÌÑ∞ÏÖâÌÑ∞: 401 Ïãú Refresh TokenÏúºÎ°ú Ïû¨ÏãúÎèÑ
 */
authAxios.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config

    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true

      const refreshToken = useAuthStore.getState().refreshToken

      if (refreshToken) {
        try {
          const newAccessToken = await refreshAccessToken(refreshToken)
          useAuthStore.getState().setToken(newAccessToken)

          originalRequest.headers.Authorization = `Bearer ${newAccessToken}`
          return authAxios(originalRequest)
        } catch (refreshError) {
          useAuthStore.getState().logout()
          window.location.href = '/login'
          return Promise.reject(refreshError)
        }
      }
    }

    return Promise.reject(error)
  }
)
```

---

### 3. `queries/login/login.ts` - OAuth API Ìï®Ïàò

```typescript
import axios from 'axios'
import { authAxios } from './axios-config'

const AUTH_API_BASE = process.env.NEXT_PUBLIC_AUTH_API_BASE || 'http://localhost:8001'

/**
 * Google OAuth Î°úÍ∑∏Ïù∏ ÏãúÏûë
 */
export const initiateGoogleLogin = () => {
  window.location.href = `${AUTH_API_BASE}/auth/oauth/google`
}

/**
 * URLÏóêÏÑú Access Token + Refresh Token Ï∂îÏ∂ú
 */
export const extractTokensFromUrl = (): {
  token: string | null
  refreshToken: string | null
} => {
  const params = new URLSearchParams(window.location.search)
  return {
    token: params.get('token'),
    refreshToken: params.get('refresh_token'),
  }
}

/**
 * Refresh TokenÏúºÎ°ú Access Token Ïû¨Î∞úÍ∏â ‚≠ê
 */
export const refreshAccessToken = async (refreshToken: string): Promise<string> => {
  const response = await axios.post(`${AUTH_API_BASE}/auth/oauth/refresh`, {
    refresh_token: refreshToken,
  })

  if (response.status !== 200) {
    throw new Error('Token refresh failed')
  }

  return response.data.access_token
}

/**
 * JWT ÌÜ†ÌÅ∞ Í≤ÄÏ¶ù
 */
export const verifyToken = async (token: string) => {
  const response = await authAxios.post('/auth/verify')
  return response.data
}

/**
 * ÎÇ¥ Ï†ïÎ≥¥ Ï°∞Ìöå
 */
export const getMe = async (token: string) => {
  const response = await authAxios.get('/auth/me')
  return response.data
}

/**
 * ÌÖåÏä§Ìä∏ ÌÜ†ÌÅ∞ Î∞úÍ∏â (Í∞úÎ∞úÏö©)
 */
export const getTestToken = async (email: string = 'test@example.com') => {
  const response = await axios.post(`${AUTH_API_BASE}/auth/oauth/test-token`, { email })

  if (response.status !== 200) {
    throw new Error('Failed to get test token')
  }

  return response.data
}
```

---

### 4. `stores/shared/user.ts` - Auth Store (Zustand + Persist) ‚≠ê

```typescript
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

interface IUser {
  user_id: number
  email: string
  name?: string
}

interface IAuthState {
  token: string | null
  refreshToken: string | null  // ‚≠ê Refresh Token Ï∂îÍ∞Ä
  user: IUser | null
  setToken: (token: string | null) => void
  setRefreshToken: (refreshToken: string | null) => void  // ‚≠ê
  setUser: (user: IUser | null) => void
  logout: () => void
  isAuthenticated: () => boolean
}

/**
 * Ïù∏Ï¶ù ÏÉÅÌÉú Í¥ÄÎ¶¨
 * - localStorageÏóê ÏûêÎèô Ï†ÄÏû• (ÏÉàÎ°úÍ≥†Ïπ® Ïãú Î°úÍ∑∏Ïù∏ Ïú†ÏßÄ)
 * - Access Token + Refresh Token Í¥ÄÎ¶¨
 */
export const useAuthStore = create<IAuthState>()(
  persist(
    (set, get) => ({
      token: null,
      refreshToken: null,
      user: null,
      setToken: (token) => set({ token }),
      setRefreshToken: (refreshToken) => set({ refreshToken }),
      setUser: (user) => set({ user }),
      logout: () => set({ token: null, refreshToken: null, user: null }),
      isAuthenticated: () => {
        const { token } = get()
        return !!token
      },
    }),
    {
      name: 'auth-storage',  // localStorage ÌÇ§
    }
  )
)
```

---

### 5. `app/login/page.tsx` - Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ

```typescript
'use client'  // ‚≠ê Client Component

import { useRouter } from 'next/navigation'  // ‚≠ê next/navigation
import { useGetTestToken, initiateGoogleLogin } from '@/queries/login'

/**
 * Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ
 * - Google OAuth Î°úÍ∑∏Ïù∏ Î≤ÑÌäº
 * - ÌÖåÏä§Ìä∏ Î°úÍ∑∏Ïù∏ (Í∞úÎ∞ú Î™®ÎìúÎßå)
 */
function Login() {
  const testTokenMutation = useGetTestToken()
  const router = useRouter()

  const handleGoogleLogin = () => {
    initiateGoogleLogin()  // Auth ÏÑúÎ≤ÑÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏
  }

  const handleTestLogin = () => {
    testTokenMutation.mutate('test@example.com', {
      onSuccess: () => {
        console.log('‚úÖ Test login success')
        router.push('/')  // ‚≠ê Next.js router
      },
    })
  }

  return (
    <main>
      <h1>Î°úÍ∑∏Ïù∏</h1>
      
      <button onClick={handleGoogleLogin}>
        üîê GoogleÎ°ú Î°úÍ∑∏Ïù∏
      </button>

      {/* Í∞úÎ∞ú ÌôòÍ≤ΩÏóêÏÑúÎßå ÌëúÏãú */}
      {process.env.NODE_ENV === 'development' && (  // ‚≠ê process.env
        <button
          onClick={handleTestLogin}
          disabled={testTokenMutation.isPending}
        >
          {testTokenMutation.isPending ? 'Î°úÎî©Ï§ë...' : 'üß™ ÌÖåÏä§Ìä∏ Î°úÍ∑∏Ïù∏'}
        </button>
      )}
    </main>
  )
}

export default Login
```

---

### 6. `app/auth/callback/page.tsx` - OAuth ÏΩúÎ∞± ÌéòÏù¥ÏßÄ

```typescript
'use client'  // ‚≠ê Client Component

import { useEffect } from 'react'
import { useRouter } from 'next/navigation'  // ‚≠ê next/navigation
import { extractTokensFromUrl } from '@/queries/login'
import { useAuthStore } from '@/stores/shared/user'
import { useGetMe } from '@/queries/login'

/**
 * OAuth ÏΩúÎ∞± ÌéòÏù¥ÏßÄ
 * - URLÏóêÏÑú Access Token + Refresh Token Ï∂îÏ∂ú
 * - ZustandÏóê Ï†ÄÏû•
 * - ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå
 * - ÌôàÏúºÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏
 */
function AuthCallback() {
  const router = useRouter()
  const { setToken, setRefreshToken, setUser, token } = useAuthStore()

  useEffect(() => {
    const { token: urlToken, refreshToken } = extractTokensFromUrl()
    
    console.log('üîç Extracted from URL:', { 
      token: urlToken ? 'exists' : 'null',
      refreshToken: refreshToken ? 'exists' : 'null' 
    })
    
    if (urlToken && refreshToken) {
      setToken(urlToken)
      setRefreshToken(refreshToken)  // ‚≠ê Refresh Token Ï†ÄÏû•
      console.log('‚úÖ Tokens saved to store')
      
      // URL Ï†ïÎ¶¨
      window.history.replaceState({}, '', '/auth/callback')
    } else if (!token) {
      console.error('‚ùå No tokens in URL and store')
      router.push('/login')
    }
  }, [])

  const { data: userData, isLoading, error } = useGetMe(token, !!token)

  useEffect(() => {
    if (userData) {
      setUser(userData)
      console.log('‚úÖ User info loaded:', userData)
      router.push('/')
    }
  }, [userData, setUser, router])

  useEffect(() => {
    if (error) {
      console.error('‚ùå Failed to fetch user info:', error)
      router.push('/login')
    }
  }, [error, router])

  return (
    <div style={{ textAlign: 'center', marginTop: '50px' }}>
      {isLoading ? (
        <>
          <h2>Î°úÍ∑∏Ïù∏ Ï§ë...</h2>
          <p>Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</p>
        </>
      ) : (
        <h2>ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î°úÎî© Ï§ë...</h2>
      )}
    </div>
  )
}

export default AuthCallback
```

---

### 7. `app/gallery/page.tsx` - Ïù¥ÎØ∏ÏßÄ Í∞§Îü¨Î¶¨

```typescript
'use client'  // ‚≠ê Client Component

import { useMyImages } from '@/queries/image'

/**
 * Ïù¥ÎØ∏ÏßÄ Í∞§Îü¨Î¶¨ ÌéòÏù¥ÏßÄ
 * - ÎÇ¥Í∞Ä ÏóÖÎ°úÎìúÌïú Ïù¥ÎØ∏ÏßÄ Î™©Î°ù ÌëúÏãú
 * - Presigned URLÎ°ú Ïù¥ÎØ∏ÏßÄ Î°úÎìú
 */
export default function GalleryPage() {
  const { data, isLoading, error } = useMyImages()
  
  if (isLoading) {
    return <div>Ïù¥ÎØ∏ÏßÄ Î°úÎî© Ï§ë...</div>
  }
  
  if (error) {
    return <div>ÏóêÎü¨ Î∞úÏÉù: {error instanceof Error ? error.message : 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}</div>
  }
  
  if (!data || data.images.length === 0) {
    return <div>ÏóÖÎ°úÎìúÌïú Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>
  }
  
  return (
    <div className="container mx-auto p-4">
      <h1 className="text-3xl font-bold mb-6">ÎÇ¥ Ïù¥ÎØ∏ÏßÄ</h1>
      
      <div className="text-sm text-gray-500 mb-4">
        Ï¥ù {data.count}Í∞úÏùò Ïù¥ÎØ∏ÏßÄ
      </div>
      
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {data.images.map((image) => (
          <div key={image.id} className="border rounded-lg overflow-hidden shadow">
            {/* ‚ö†Ô∏è Next.js Image ÎåÄÏã† ÏùºÎ∞ò img ÏÇ¨Ïö© (Presigned URL) */}
            <img 
              src={image.url}
              alt={image.filename}
              className="w-full h-48 object-cover"
              loading="lazy"
            />
            
            <div className="p-3">
              <p className="text-sm font-medium truncate">{image.filename}</p>
              <p className="text-xs text-gray-500">{formatFileSize(image.size)}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}

function formatFileSize(bytes: number): string {
  if (bytes < 1024) return `${bytes} B`
  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`
  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`
}
```

---

## üåê ÌôòÍ≤Ω Î≥ÄÏàò

`.env` ÌååÏùº:

```bash
# Auth ÏÑúÎ≤Ñ URL
NEXT_PUBLIC_AUTH_API_BASE=http://localhost:8001

# API ÏÑúÎ≤Ñ URL (Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú)
NEXT_PUBLIC_API_BASE=http://localhost:8080
```

‚ö†Ô∏è **Ï£ºÏùò:** Next.jsÏóêÏÑúÎäî `NEXT_PUBLIC_` Ï†ëÎëêÏÇ¨Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§!

---

## üîó API ÏóîÎìúÌè¨Ïù∏Ìä∏

### Auth ÏÑúÎ≤Ñ (localhost:8001)

| ÏóîÎìúÌè¨Ïù∏Ìä∏ | Î©îÏÑúÎìú | ÏÑ§Î™Ö |
|-----------|-------|------|
| `/auth/oauth/google` | GET | Google OAuth ÏãúÏûë (Î¶¨Îã§Ïù¥Î†âÌä∏) |
| `/auth/oauth/google/callback` | GET | Google OAuth ÏΩúÎ∞± (ÏÑúÎ≤Ñ Ï†ÑÏö©) |
| `/auth/oauth/test-token` | POST | ÌÖåÏä§Ìä∏ ÌÜ†ÌÅ∞ Î∞úÍ∏â (Í∞úÎ∞úÏö©) |
| `/auth/oauth/refresh` | POST | ‚≠ê Refresh TokenÏúºÎ°ú Access Token Ïû¨Î∞úÍ∏â |
| `/auth/verify` | POST | JWT ÌÜ†ÌÅ∞ Í≤ÄÏ¶ù |
| `/auth/me` | GET | ÎÇ¥ Ï†ïÎ≥¥ Ï°∞Ìöå (JWT ÌïÑÏöî) |

### API ÏÑúÎ≤Ñ (localhost:8080)

| ÏóîÎìúÌè¨Ïù∏Ìä∏ | Î©îÏÑúÎìú | ÏÑ§Î™Ö |
|-----------|-------|------|
| `/uploads` | POST | Presigned URL Î∞úÍ∏â (ÏóÖÎ°úÎìúÏö©) |
| `/images` | GET | ÎÇ¥ Ïù¥ÎØ∏ÏßÄ Î™©Î°ù Ï°∞Ìöå (JWT ÌïÑÏöî) |
| `/images/:key` | GET | Ï°∞ÌöåÏö© Presigned URL Î∞úÍ∏â |
| `/images/public` | GET | Î™®Îì† Ïù¥ÎØ∏ÏßÄ Î™©Î°ù (Í≥µÍ∞ú) |

---

## üêõ Ìä∏Îü¨Î∏îÏäàÌåÖ

### 1. `useRouter` ÏóêÎü¨

```
Error: useRouter must be used in a client component
```

**Ìï¥Í≤∞:** ÌååÏùº ÏÉÅÎã®Ïóê `'use client'` Ï∂îÍ∞Ä
```typescript
'use client'

import { useRouter } from 'next/navigation'
```

### 2. QueryClient ÏóêÎü¨

```
Only plain objects can be passed to Client Components
```

**Ìï¥Í≤∞:** `providers.tsx`ÏóêÏÑú `useState`Î°ú QueryClient ÏÉùÏÑ±
```typescript
'use client'

const [queryClient] = useState(() => new QueryClient())
```

### 3. Next.js Image 400 Error (Presigned URL)

```
400 Bad Request when using next/image with Presigned URL
```

**Ìï¥Í≤∞:** ÏùºÎ∞ò `<img>` ÌÉúÍ∑∏ ÏÇ¨Ïö© (Presigned URLÏùò ÏÑúÎ™ÖÏù¥ Íπ®ÏßÄÏßÄ ÏïäÎèÑÎ°ù)
```typescript
<img src={image.url} alt={image.filename} />
```

### 4. CORS ÏóêÎü¨

```
Access to XMLHttpRequest has been blocked by CORS policy
```

**Ìï¥Í≤∞:** Auth ÏÑúÎ≤ÑÏóêÏÑú `http://localhost:3000` ÌóàÏö© ÌôïÏù∏
```python
# backend/apps/auth/src/server.py
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 5. ÌôòÍ≤ΩÎ≥ÄÏàòÍ∞Ä undefined

**ÌôïÏù∏ ÏÇ¨Ìï≠:**
- ÌôòÍ≤ΩÎ≥ÄÏàòÏóê `NEXT_PUBLIC_` Ï†ëÎëêÏÇ¨Í∞Ä ÏûàÎäîÏßÄ
- `.env` ÌååÏùºÏù¥ Î£®Ìä∏ ÎîîÎ†âÌÜ†Î¶¨Ïóê ÏûàÎäîÏßÄ
- ÏÑúÎ≤Ñ Ïû¨ÏãúÏûëÌñàÎäîÏßÄ

---

## üì¶ ÏùòÏ°¥ÏÑ±

### Ï£ºÏöî ÎùºÏù¥Î∏åÎü¨Î¶¨

```json
{
  "dependencies": {
    "next": "15.1.6",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "@tanstack/react-query": "^5.75.7",
    "zustand": "^5.0.4",
    "axios": "^1.7.9"
  },
  "devDependencies": {
    "typescript": "^5",
    "@types/react": "^19",
    "eslint": "^9",
    "prettier": "^3.4.2"
  }
}
```

---

## üöÄ Vite ‚Üí Next.js ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï£ºÏöî Î≥ÄÍ≤ΩÏÇ¨Ìï≠

| Ìï≠Î™© | Vite + React | Next.js |
|------|-------------|---------|
| **ÎùºÏö∞ÌåÖ** | React Router (`react-router-dom`) | App Router (`app/` ÎîîÎ†âÌÜ†Î¶¨) |
| **ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò** | `useNavigate()` | `useRouter()` from `next/navigation` |
| **ÌôòÍ≤ΩÎ≥ÄÏàò** | `import.meta.env.VITE_*` | `process.env.NEXT_PUBLIC_*` |
| **Ïª¥Ìè¨ÎÑåÌä∏** | Î™®Îëê Client | Server Component (Í∏∞Î≥∏), `'use client'` ÌïÑÏöî Ïãú |
| **Ïù¥ÎØ∏ÏßÄ** | `<img>` | `<Image>` (ÏµúÏ†ÅÌôî), Presigned URLÏùÄ `<img>` ÏÇ¨Ïö© |
| **Í∞úÎ∞ú Î™®Îìú** | `import.meta.env.DEV` | `process.env.NODE_ENV === 'development'` |

---

## üìö Ï∞∏Í≥† ÎßÅÌÅ¨

- **Backend README**: [../backend/README.md](../backend/README.md)
- **Next.js Í≥µÏãù Î¨∏ÏÑú**: https://nextjs.org/docs
- **App Router Í∞ÄÏù¥Îìú**: https://nextjs.org/docs/app

---

## üìù To-Do

- [x] Next.js Ï†ÑÌôò (SEO) ‚úÖ
- [x] OAuth Î°úÍ∑∏Ïù∏ Íµ¨ÌòÑ ‚úÖ
- [x] Refresh Token ÏûêÎèô Í∞±Ïã† ‚úÖ
- [x] Ïù¥ÎØ∏ÏßÄ Ï°∞Ìöå ÌéòÏù¥ÏßÄ(Ìôà ÌôîÎ©¥) ‚úÖ
- [ ] Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú UI Íµ¨ÌòÑ
- [ ] ÌîÑÎ°úÌïÑ ÌéòÏù¥ÏßÄ Ï∂îÍ∞Ä
- [x] Î°úÍ∑∏ÏïÑÏõÉ Î≤ÑÌäº Ï∂îÍ∞Ä
- [ ] Î°úÎî© Ïä§ÌîºÎÑà Ïª¥Ìè¨ÎÑåÌä∏
- [ ] ÌÖåÏä§Ìä∏ ÏΩîÎìú Ï∂îÍ∞Ä (Playwright)
- [ ] Vercel? Î∞∞Ìè¨

---

## ‚ö° ÏÑ±Îä• ÏµúÏ†ÅÌôî

### Server Components ÌôúÏö©
- Í∞ÄÎä•Ìïú Î™®Îì† Ïª¥Ìè¨ÎÑåÌä∏Î•º Server ComponentÎ°ú ÏûëÏÑ±
- Client ComponentÎäî ÌïÑÏöî ÏãúÏóêÎßå (`'use client'`)

### Image Optimization
- Ï†ïÏ†Å Ïù¥ÎØ∏ÏßÄ: `next/image` ÏÇ¨Ïö©
- Presigned URL: ÏùºÎ∞ò `<img>` ÏÇ¨Ïö© (ÏÑúÎ™Ö Ïú†ÏßÄ)

### Caching
- React Query: 5Î∂Ñ Ï∫êÏã± (`staleTime: 60 * 1000`)
- Zustand: localStorage persist (Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Ïú†ÏßÄ)

---

**Made with using Next.js 15**
